# Local production simulation overrides.
# Usage:
#   APP_ENV_FILE=.env.prod.local docker compose --env-file .env.prod.local -p cryptopay-prod-sim \
#     -f docker-compose.prod.yml -f docker-compose.prod.sim.yml up -d --build

services:
  postgres:
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-cryptopay}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-cryptopay}
      POSTGRES_DB: ${POSTGRES_DB:-cryptopay}
    ports: !override
      - '127.0.0.1:15432:5432'

  redis:
    ports: !override
      - '127.0.0.1:16379:6379'

  core-api:
    image: cryptopay/core-api:prod-sim
    build:
      context: .
      dockerfile: services/core-api/Dockerfile
    env_file:
      - .env.prod.local
    ports: !override
      - '127.0.0.1:13001:3001'

  customer-auth:
    image: cryptopay/customer-auth:prod-sim
    build:
      context: .
      dockerfile: services/customer-auth/Dockerfile
    env_file:
      - .env.prod.local
    ports: !override
      - '127.0.0.1:13005:3005'

  offshore-collector:
    image: cryptopay/offshore-collector:prod-sim
    build:
      context: .
      dockerfile: services/offshore-collector/Dockerfile
    env_file:
      - .env.prod.local
    ports: !override
      - '127.0.0.1:13002:3002'

  payout-orchestrator:
    image: cryptopay/payout-orchestrator:prod-sim
    build:
      context: .
      dockerfile: services/payout-orchestrator/Dockerfile
    env_file:
      - .env.prod.local
    ports: !override
      - '127.0.0.1:13003:3003'

  reconciliation-worker:
    image: cryptopay/reconciliation-worker:prod-sim
    build:
      context: .
      dockerfile: services/reconciliation-worker/Dockerfile
    env_file:
      - .env.prod.local
    ports: !override
      - '127.0.0.1:13004:3004'

  admin-api:
    image: cryptopay/admin-api:prod-sim
    build:
      context: .
      dockerfile: services/admin-api/Dockerfile
    env_file:
      - .env.prod.local
    ports: !override
      - '127.0.0.1:13010:3010'

  base-watcher:
    image: cryptopay/base-watcher:prod-sim
    build:
      context: .
      dockerfile: workers/base-watcher/Dockerfile
    env_file:
      - .env.prod.local

  solana-watcher:
    image: cryptopay/solana-watcher:prod-sim
    build:
      context: .
      dockerfile: workers/solana-watcher/Dockerfile
    env_file:
      - .env.prod.local

  web:
    image: cryptopay/web:prod-sim
    build:
      context: .
      dockerfile: apps/web/Dockerfile
      args:
        NEXT_PUBLIC_SOLANA_CLUSTER: ${NEXT_PUBLIC_SOLANA_CLUSTER:-mainnet-beta}
        NEXT_PUBLIC_WALLET_MODE: ${NEXT_PUBLIC_WALLET_MODE:-real}
        NEXT_PUBLIC_LANDING_USDC_ETB_RATE: ${NEXT_PUBLIC_LANDING_USDC_ETB_RATE:-140}
        NEXT_PUBLIC_LANDING_USDT_ETB_RATE: ${NEXT_PUBLIC_LANDING_USDT_ETB_RATE:-140}
        NEXT_PUBLIC_LANDING_FEE_USD: ${NEXT_PUBLIC_LANDING_FEE_USD:-1}
    env_file:
      - .env.prod.local
    ports: !override
      - '127.0.0.1:18080:3000'
